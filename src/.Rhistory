nmds <- metaMDS(bray_dist, k = 2, trymax = 100)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE)) %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 100)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE)) %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 50)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE)) %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 50)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE)) %>%
pivot_wider(names_from = Variable, values_from = mean_value)
print(mat)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 50)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE)) %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
print(dist_mat)
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 50)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE)) %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 40)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 40)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
print(dist_mat)
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 40)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
print(dist_mat)
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 40)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(names_from = Variable, values_from = mean_value)
print(mat)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray", na.rm = TRUE)
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 50)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray")
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 30)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray")
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 20)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
library(vegan)
data_long <- data_long %>%
mutate(Year = format(as.Date(Date), "%Y"))
print(data_long)
years <- 2019:2023
nmds_results <- list()
for (yr in years) {
# 过滤当年数据
year_data <- data_long %>% filter(Year == as.character(yr))
# 构建“地区 × 指标”宽表：对每个地区每个指标计算均值（或中位数）
mat <- year_data %>%
group_by(Location, Variable) %>%
summarise(mean_value = mean(Value, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(names_from = Variable, values_from = mean_value)
# 移除Location列，得到纯数值矩阵
dist_mat <- mat %>% select(-Location) %>%
as.data.frame() %>%
mutate(across(everything(), as.numeric))
# 行名设为地区
rownames(dist_mat) <- mat$Location
# 计算距离矩阵 (Bray-Curtis)
bray_dist <- vegdist(dist_mat, method = "bray")
# 运行nMDS (k=2维)
nmds <- metaMDS(bray_dist, k = 2, trymax = 50)
# 提取nMDS坐标，转为data.frame，添加年份和地区信息
nmds_points <- as.data.frame(nmds$points)
nmds_points$Location <- rownames(nmds_points)
nmds_points$Year <- yr
# 保存结果
nmds_results[[as.character(yr)]] <- nmds_points
}
nmds_all <- bind_rows(nmds_results)
# 画图：x,y是nMDS坐标，颜色区分地区，动画或分面展示年份趋势
ggplot(nmds_all, aes(x = MDS1, y = MDS2, color = Location)) +
geom_point(size = 3) +
facet_wrap(~ Year) +
theme_bw() +
labs(title = "各年份不同地区水质指标的nMDS分析", x = "nMDS1", y = "nMDS2")
